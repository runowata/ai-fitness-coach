{% extends 'base/base.html' %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è - AI Fitness Coach{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <form method="post">
                            {% csrf_token %}
                            
                            <div class="mb-3">
                                <label for="{{ form.notification_time.id_for_label }}" class="form-label">
                                    {{ form.notification_time.label }}
                                </label>
                                {{ form.notification_time }}
                                <div class="form-text">–í—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ</div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    {{ form.push_notifications_enabled }}
                                    <label class="form-check-label" for="{{ form.push_notifications_enabled.id_for_label }}">
                                        {{ form.push_notifications_enabled.label }}
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    {{ form.email_notifications_enabled }}
                                    <label class="form-check-label" for="{{ form.email_notifications_enabled.id_for_label }}">
                                        {{ form.email_notifications_enabled.label }}
                                    </label>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Archetype Change -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0">–°–º–µ–Ω–∞ —Ç—Ä–µ–Ω–µ—Ä–∞</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">
                            –¢–µ–∫—É—â–∏–π –∞—Ä—Ö–µ—Ç–∏–ø: 
                            <strong>
                                {% if user.archetype == 'bro' %}ü§ô –ë—Ä–æ
                                {% elif user.archetype == 'sergeant' %}üéñÔ∏è –°–µ—Ä–∂–∞–Ω—Ç
                                {% elif user.archetype == 'intellectual' %}üéì –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª
                                {% else %}–ù–µ –≤—ã–±—Ä–∞–Ω{% endif %}
                            </strong>
                        </p>
                        
                        <a href="{% url 'onboarding:select_archetype' %}" class="btn btn-outline-primary">
                            <i class="fas fa-user-edit"></i> –°–º–µ–Ω–∏—Ç—å —Ç—Ä–µ–Ω–µ—Ä–∞
                        </a>
                        
                        <div class="mt-2">
                            <small class="text-muted">
                                –°–º–µ–Ω–∞ —Ç—Ä–µ–Ω–µ—Ä–∞ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç–∏–ª—å –ø–æ–¥–∞—á–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <!-- User Stats -->
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="h3 text-primary">{{ user.level }}</div>
                            <small class="text-muted">–£—Ä–æ–≤–µ–Ω—å</small>
                        </div>
                        
                        <div class="progress mb-3">
                            {% with current_xp=user.experience_points %}
                            {% with next_level_xp=user.level|add:"1"|floatformat:"0" %}
                            <div class="progress-bar" style="width: {% widthratio current_xp 100 100 %}%"></div>
                            {% endwith %}
                            {% endwith %}
                        </div>
                        
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="h5 text-success">{{ user.current_streak }}</div>
                                <small class="text-muted">–¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</small>
                            </div>
                            <div class="col-6">
                                <div class="h5 text-info">{{ user.total_workouts_completed }}</div>
                                <small class="text-muted">—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Account Management -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h6 class="mb-0">üîê –ê–∫–∫–∞—É–Ω—Ç</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{% url 'password_reset' %}" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-key"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                            </a>
                            
                            {% if not user.is_2fa_enabled %}
                                <button class="btn btn-outline-warning btn-sm" disabled>
                                    <i class="fas fa-shield-alt"></i> –í–∫–ª—é—á–∏—Ç—å 2FA
                                </button>
                                <small class="text-muted">–°–∫–æ—Ä–æ –¥–æ—Å—Ç—É–ø–Ω–æ</small>
                            {% endif %}
                        </div>
                        
                        <hr>
                        
                        <div class="text-center">
                            <button class="btn btn-outline-danger btn-sm" onclick="confirmDelete()">
                                <i class="fas fa-user-times"></i> –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</p>
                <p class="text-danger">
                    <strong>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!</strong> 
                    –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—Ä–∏—è–º –±—É–¥—É—Ç —É—Ç–µ—Ä—è–Ω—ã.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-danger" onclick="deleteAccount()">
                    –î–∞, —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function confirmDelete() {
    new bootstrap.Modal(document.getElementById('deleteModal')).show();
}

function deleteAccount() {
    // TODO: Implement account deletion
    alert('–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö');
}
</script>
{% endblock %}