{% extends 'base/base.html' %}

{% block title %}–î–∞—à–±–æ—Ä–¥ - AI Fitness Coach{% endblock %}

{% block content %}

<!-- Program Completion Notification -->
{% if program_completion_available %}
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-success alert-dismissible fade show border-0 shadow-sm" 
             style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white;">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="fas fa-trophy fa-2x"></i>
                </div>
                <div class="flex-grow-1">
                    <h5 class="alert-heading mb-2">üéâ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h5>
                    <p class="mb-2">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏ 6-–Ω–µ–¥–µ–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫. 
                       –í—Ä–µ–º—è –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–≤–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ!</p>
                    <a href="{% url 'workouts:program_completion' %}" 
                       class="btn btn-light btn-sm fw-bold">
                        <i class="fas fa-rocket me-1"></i>
                        –í—ã–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª
                    </a>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" 
                        aria-label="Close"></button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h5>
                <span class="badge bg-info">–ù–µ–¥–µ–ª—è {{ current_week }}</span>
            </div>
            <div class="card-body">
                {% if today_workout %}
                    <h6>{{ today_workout.name }}</h6>
                    
                    {% if today_workout.is_rest_day %}
                        <div class="alert alert-info">
                            <i class="fas fa-bed"></i> –°–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å –æ—Ç–¥—ã—Ö–∞! –û—Ç–¥–æ—Ö–Ω–∏—Ç–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å.
                        </div>
                    {% else %}
                        <p class="text-muted">{{ today_workout.exercises|length }} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p>
                        
                        {% if today_workout.completed_at %}
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle"></i> –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
                                {% if today_workout.feedback_rating %}
                                    <br>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞: 
                                    {% if today_workout.feedback_rating == 'fire' %}üî• –û—Ç–ª–∏—á–Ω–æ
                                    {% elif today_workout.feedback_rating == 'smile' %}üôÇ –•–æ—Ä–æ—à–æ
                                    {% elif today_workout.feedback_rating == 'neutral' %}üòê –ù–æ—Ä–º–∞–ª—å–Ω–æ
                                    {% elif today_workout.feedback_rating == 'tired' %}ü§ï –¢—è–∂–µ–ª–æ
                                    {% endif %}
                                {% endif %}
                            </div>
                        {% else %}
                            <a href="{% url 'workouts:daily_workout' today_workout.id %}" 
                               class="btn btn-primary btn-lg">
                                <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                            </a>
                        {% endif %}
                    {% endif %}
                    
                    {% if today_workout.confidence_task %}
                        <div class="mt-3">
                            <h6>–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</h6>
                            <p class="text-muted">{{ today_workout.confidence_task }}</p>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> 
                        –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Progress Stats -->
        <div class="card mb-3">
            <div class="card-header">
                <h6 class="mb-0">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h6>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <div class="h3 text-success">{{ streak }}</div>
                        <small class="text-muted">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</small>
                    </div>
                    <div class="col-6">
                        <div class="h3 text-primary">{{ profile.total_workouts_completed }}</div>
                        <small class="text-muted">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</small>
                    </div>
                </div>
                
                <!-- XP Progress Bar -->
                <div class="mt-3">
                    <div class="d-flex justify-content-between">
                        <small>–£—Ä–æ–≤–µ–Ω—å {{ level }}</small>
                        <small>{{ xp }} XP</small>
                    </div>
                    {% with next_level_xp=level|add:1|floatformat:0 %}
                        {% with xp_needed=next_level_xp|floatformat:0 %}
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" 
                                     style="width: {{ xp|floatformat:0 }}%" 
                                     aria-valuenow="{{ xp }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                </div>
                            </div>
                        {% endwith %}
                    {% endwith %}
                </div>
            </div>
        </div>
        
        <!-- Recent Achievements -->
        {% if new_achievements %}
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">üèÜ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!</h6>
            </div>
            <div class="card-body">
                {% for achievement in new_achievements %}
                    <div class="alert alert-warning">
                        <strong>{{ achievement.achievement.name }}</strong>
                        <br>{{ achievement.achievement.description }}
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}