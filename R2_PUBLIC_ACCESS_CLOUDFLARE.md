# Настройка публичного доступа R2 через Cloudflare Dashboard

## Проблема
R2 не поддерживает bucket policies (получили ошибку "PutBucketPolicy not implemented"). Нужно настроить публичный доступ через Cloudflare Dashboard.

## Решение

### Вариант 1: Включить Public Access для bucket

1. **Зайти в Cloudflare Dashboard**
   - https://dash.cloudflare.com
   - Выбрать аккаунт

2. **Открыть R2 Object Storage**
   - В левом меню найти "R2 Object Storage"
   - Выбрать bucket `ai-fitness-media`

3. **Настроить публичный доступ**
   - Перейти на вкладку **Settings**
   - Найти секцию **Public access**
   - Нажать **Allow Access** 
   - Подтвердить действие

4. **Проверить результат**
   - URL должен стать доступным: 
   - `https://pub-92568f8b8a15c68a9ece5fe08c66485b.r2.dev/photos/progress/card_progress_0066.jpg`

### Вариант 2: Custom Domain (если нужна более точная настройка)

1. **В настройках bucket**
   - Перейти в **Custom Domains**
   - Добавить поддомен для публичных файлов
   - Настроить правила доступа только для `photos/progress/*`

## Проверка на сервере

После настройки в Cloudflare Dashboard выполните на сервере:
```bash
python setup_r2_public_domain.py
```

Этот скрипт проверит:
- ✅ Доступ к bucket
- ✅ Наличие файлов в `photos/progress/`  
- ✅ Публичный доступ по URL

## Ожидаемый результат

После настройки:
- ✅ `curl -I https://pub-92568f8b8a15c68a9ece5fe08c66485b.r2.dev/photos/progress/card_progress_0066.jpg` вернёт `200 OK`
- ✅ Мотивационные карточки отобразятся с изображениями
- ✅ Только папка `photos/progress/` станет публичной

## Безопасность

✅ **Безопасно:** При настройке публичного доступа к bucket можно указать только определённые папки  
✅ **Контроль:** Cloudflare предоставляет детальные настройки доступа  
✅ **Приватность:** Другие файлы остаются приватными если правильно настроить

## Альтернативное решение

Если не получается настроить публичный доступ, можно:
1. Использовать signed URLs (временные ссылки)
2. Проксировать запросы через Django
3. Переместить мотивационные изображения на CDN

---

**Файлы:**
- `setup_r2_public_domain.py` - скрипт диагностики
- `apply_bucket_policy.py` - не работает с R2 (bucket policies не поддерживаются)