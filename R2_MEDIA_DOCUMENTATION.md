# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ú–µ–¥–∏–∞—Ç–µ–∫–∞ AI Fitness Coach –≤ Cloudflare R2

## üéØ –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ß—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ–º
–ü–æ–ª–Ω—É—é –º–µ–¥–∏–∞—Ç–µ–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏—Ç–Ω–µ—Å-–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **AI Fitness Coach** - Django-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è –≥–µ–µ–≤.

### –ö—É–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º
**Cloudflare R2 Object Storage** - S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **Bucket:** `ai-fitness-media`
- **Account ID:** `92568f8b8a15c68a9ece5fe08c66485b`
- **Endpoint:** `https://92568f8b8a15c68a9ece5fe08c66485b.r2.cloudflarestorage.com`
- **Public URL:** `https://pub-92568f8b8a15c68a9ece5fe08c66485b.r2.dev/`

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- **Python 3.12** —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π **boto3** (AWS SDK)
- **S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API** –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- **10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- **SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** –ø—Ä–∏ —Å–±–æ—è—Ö

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–¥–∏–∞—Ç–µ–∫–∏

### –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:** 3,346
- **–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:** 43.89 GB
- **–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:** 99.97% (3345/3346 —Ñ–∞–π–ª–æ–≤)

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

#### üìπ –í–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–Ω—Ç (1,333 —Ñ–∞–π–ª–æ–≤, ~43.3 GB)

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—É—Ç—å –≤ R2 | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------------|-----------|----------|
| **–¢–µ—Ö–Ω–∏–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π** | 147 | `videos/exercises/explain/` | –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏ |
| **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** | 441 | `videos/reminders/` | –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è |
| **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** | 423 | `videos/instructions/` | –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç —Ç—Ä–µ–Ω–µ—Ä–æ–≤ |
| **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è** | 15 | `videos/intros/` | –í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ —Ç—Ä–µ–Ω–µ—Ä–æ–≤ |
| **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è** | 5 | `videos/weekly/` | –ù–µ–¥–µ–ª—å–Ω—ã–µ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–æ–ª–∏–∫–∏ |
| **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏** | 10 | `videos/closing/` | –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è —Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º |
| **–û—à–∏–±–∫–∏ –≤ —Ç–µ—Ö–Ω–∏–∫–µ** | 134 | `videos/exercises/mistake/` | –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ |
| **–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞** | 158 | `videos/exercises/technique/` | –ë–∞–∑–æ–≤—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è |

#### üñºÔ∏è –§–æ—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç (2,000 —Ñ–∞–π–ª–æ–≤, ~0.56 GB)

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—É—Ç—å –≤ R2 | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------------|-----------|----------|
| **–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã** | 1,000 | `photos/quotes/` | –ö–∞—Ä—Ç–æ—á–∫–∏ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏ |
| **–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏** | 500 | `photos/workout/` | –í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ |
| **–ü—Ä–æ–≥—Ä–µ—Å—Å-–∫–∞—Ä—Ç–æ—á–∫–∏** | 500 | `photos/progress/` | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π |

#### üë§ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—É—Ç—å –≤ R2 | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------------|-----------|----------|
| **–ê–≤–∞—Ç–∞—Ä—ã —Ç—Ä–µ–Ω–µ—Ä–æ–≤** | 10 | `images/avatars/` | –§–æ—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–µ—Ä–æ–≤ |
| **–°–ª—É–∂–µ–±–Ω—ã–µ —Ñ–∞–π–ª—ã** | 3 | –∫–æ—Ä–µ–Ω—å | –°–∫—Ä–∏–ø—Ç—ã –∏ –ª–æ–≥–∏ |

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Render.com

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Render

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª—é—á–∏ R2
R2_ACCESS_KEY_ID=3a9fd5a6b38ec994e057e33c1096874e
R2_SECRET_ACCESS_KEY=0817f9a3154b63b1968620a966e05e36f80fca0308ba91d9c8bf65e8622baa13
R2_ACCOUNT_ID=92568f8b8a15c68a9ece5fe08c66485b
R2_BUCKET=ai-fitness-media
R2_ENDPOINT=https://92568f8b8a15c68a9ece5fe08c66485b.r2.cloudflarestorage.com

# Django Storage –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
USE_R2_STORAGE=True
DEFAULT_FILE_STORAGE=storages.backends.s3boto3.S3Boto3Storage
AWS_S3_ENDPOINT_URL=${R2_ENDPOINT}
AWS_STORAGE_BUCKET_NAME=${R2_BUCKET}
AWS_S3_REGION_NAME=auto
AWS_S3_SIGNATURE_VERSION=s3v4
AWS_DEFAULT_ACL=private
AWS_QUERYSTRING_AUTH=True
AWS_QUERYSTRING_EXPIRE=3600
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Django (settings.py)

```python
# settings/production.py

import os

if os.environ.get('USE_R2_STORAGE') == 'True':
    # Cloudflare R2 Storage
    DEFAULT_FILE_STORAGE = 'storages.backends.s3boto3.S3Boto3Storage'
    
    AWS_ACCESS_KEY_ID = os.environ.get('R2_ACCESS_KEY_ID')
    AWS_SECRET_ACCESS_KEY = os.environ.get('R2_SECRET_ACCESS_KEY')
    AWS_STORAGE_BUCKET_NAME = os.environ.get('R2_BUCKET')
    AWS_S3_ENDPOINT_URL = os.environ.get('R2_ENDPOINT')
    AWS_S3_REGION_NAME = 'auto'
    AWS_S3_SIGNATURE_VERSION = 's3v4'
    AWS_DEFAULT_ACL = 'private'
    AWS_S3_OBJECT_PARAMETERS = {
        'CacheControl': 'max-age=86400',
    }
    AWS_QUERYSTRING_AUTH = True
    AWS_QUERYSTRING_EXPIRE = 3600  # 1 —á–∞—Å –Ω–∞ signed URLs
    
    # Media files
    MEDIA_URL = f'{AWS_S3_ENDPOINT_URL}/{AWS_STORAGE_BUCKET_NAME}/'
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Django –º–æ–¥–µ–ª—è—Ö

```python
# apps/workouts/models.py

class Exercise(models.Model):
    technique_video = models.FileField(
        upload_to='videos/exercises/technique/',
        blank=True
    )
    
    def get_video_url(self):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç signed URL –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞"""
        if self.technique_video:
            return self.technique_video.url  # django-storages –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç signed URL
        return None

# apps/content/models.py

class MotivationalCard(models.Model):
    image = models.ImageField(
        upload_to='photos/quotes/',
        blank=True
    )
    category = models.CharField(max_length=50)
    
    def get_cdn_url(self):
        """–ü–æ–ª—É—á–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π URL —á–µ—Ä–µ–∑ CDN"""
        if self.image:
            # –î–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pub-–¥–æ–º–µ–Ω
            filename = self.image.name
            return f"https://pub-92568f8b8a15c68a9ece5fe08c66485b.r2.dev/{filename}"
        return None
```

---

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# requirements.txt
django-storages==1.14.2
boto3==1.34.131
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

```python
# management/commands/migrate_to_r2.py

from django.core.management.base import BaseCommand
from django.core.files.storage import default_storage
from apps.workouts.models import Exercise
import boto3

class Command(BaseCommand):
    def handle(self, *args, **options):
        # –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
        for exercise in Exercise.objects.all():
            if exercise.local_video_path:
                with open(exercise.local_video_path, 'rb') as f:
                    exercise.technique_video.save(
                        f"exercises/{exercise.slug}_technique.mp4",
                        f
                    )
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CDN (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Cloudflare CDN:
- –°–æ–∑–¥–∞—Ç—å Custom Domain –¥–ª—è R2 bucket
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (—Ñ–æ—Ç–æ)

---

## üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞

### –°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ R2
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** $0.015 –∑–∞ GB/–º–µ—Å—è—Ü = **$0.66/–º–µ—Å—è—Ü** –∑–∞ 44GB
- **–ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:** **–ë–ï–°–ü–õ–ê–¢–ù–û** (–≥–ª–∞–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ R2)
- **–û–ø–µ—Ä–∞—Ü–∏–∏:** $0.36 –∑–∞ –º–∏–ª–ª–∏–æ–Ω –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–ª–∞—Å—Å–∞ A

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Render Disk
| –ü–∞—Ä–∞–º–µ—Ç—Ä | Render Disk | Cloudflare R2 |
|----------|-------------|---------------|
| –•—Ä–∞–Ω–µ–Ω–∏–µ 44GB | ~$11/–º–µ—Å—è—Ü | $0.66/–º–µ—Å—è—Ü |
| –ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ | –ü–ª–∞—Ç–Ω—ã–π | –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π |
| –ì–ª–æ–±–∞–ª—å–Ω–∞—è CDN | –ù–µ—Ç | –î–∞ |
| Signed URLs | –ù—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å | –í—Å—Ç—Ä–æ–µ–Ω–æ |

---

## üìù –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- `upload_to_r2.py` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ R2
- `check_upload_progress.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- `reliable_upload.sh` - –Ω–∞–¥—ë–∂–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
- `validate_media.py` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–µ–¥–∏–∞—Ç–µ–∫–∏
- `fill_missing_media.py` - –¥–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–µ–¥–∏–∞—Ç–µ–∫–∏
python check_upload_progress.py

# –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
python validate_media.py

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ–∞–π–ª—ã
python upload_to_r2.py --auto

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
./monitor_upload.sh
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
- –í—Å–µ —Ñ–∞–π–ª—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ**
- –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ **Signed URLs** —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
- –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞: 1 —á–∞—Å (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø (–¥–ª—è CDN)
- –î–æ–º–µ–Ω: `https://pub-92568f8b8a15c68a9ece5fe08c66485b.r2.dev/`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (–∫–∞—Ä—Ç–æ—á–∫–∏, –∞–≤–∞—Ç–∞—Ä—ã)
- –í–∏–¥–µ–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤—Å–µ–≥–¥–∞ —á–µ—Ä–µ–∑ Signed URLs

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **Cloudflare R2 Dashboard:** https://dash.cloudflare.com/
- **Render Dashboard:** https://dashboard.render.com/
- **Django Storages Docs:** https://django-storages.readthedocs.io/

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: 8 –∞–≤–≥—É—Å—Ç–∞ 2025*
*–í–µ—Ä—Å–∏—è: 1.0*