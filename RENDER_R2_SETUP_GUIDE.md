# –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ R2 –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞
–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ `401 Unauthorized` –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º R2.

## –†–µ—à–µ–Ω–∏–µ
–ü—Ä–∏–º–µ–Ω–∏—Ç—å bucket policy –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ `photos/progress/`

---

## –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Render Shell (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å Render Shell
1. –ó–∞–π—Ç–∏ –≤ [Render Dashboard](https://dashboard.render.com)
2. –ù–∞–π—Ç–∏ —Å–µ—Ä–≤–∏—Å **ai-fitness-coach** (Web Service)
3. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Shell**
4. –ù–∞–∂–∞—Ç—å **Launch Shell**

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤ Shell
```bash
# 1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /opt/render/project/src

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è bucket policy
python apply_bucket_policy.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üîß –ü—Ä–∏–º–µ–Ω—è–µ–º bucket policy –∫ ai-fitness-media...
üìã Policy —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
{
  "Version": "2012-10-17", 
  "Statement": [
    {
      "Sid": "PublicReadMotivationalImages",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject", 
      "Resource": "arn:aws:s3:::ai-fitness-media/photos/progress/*"
    }
  ]
}

‚úÖ Bucket policy —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω!

üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø...
curl -I https://pub-92568f8b8a15c68a9ece5fe08c66485b.r2.dev/photos/progress/card_progress_0066.jpg
‚úÖ –£–°–ü–ï–•! –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –ø—É–±–ª–∏—á–Ω–æ
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.

---

## –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å R2 credentials –∏–∑ Render
1. –í Render Dashboard ‚Üí Environment Variables
2. –ù–∞–π—Ç–∏ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è:
   - `R2_ACCESS_KEY_ID`
   - `R2_SECRET_ACCESS_KEY`

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å credentials –ª–æ–∫–∞–ª—å–Ω–æ
```bash
export R2_ACCESS_KEY_ID='your-key-from-render'
export R2_SECRET_ACCESS_KEY='your-secret-from-render'
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip install boto3 requests
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
```bash
cd "/Users/alexbel/Desktop/–ü—Ä–æ–µ–∫—Ç—ã/AI Fitness Coach"
python apply_bucket_policy.py
```

---

## –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ –¥–µ–ø–ª–æ–π (–µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç)

### –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –¥–µ–ø–ª–æ–π
```bash
git add apply_bucket_policy.py
git commit -m "Add R2 bucket policy setup script"
git push
```

### –í—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ Deploy Hook
1. –í Render Dashboard ‚Üí Settings ‚Üí Deploy Hooks
2. –°–æ–∑–¥–∞—Ç—å Deploy Hook —Å –∫–æ–º–∞–Ω–¥–æ–π:
   ```bash
   python apply_bucket_policy.py
   ```

---

## –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

‚úÖ **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞–Ω—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø—É–±–ª–∏—á–Ω–æ –ø–æ URL:**
- `https://pub-92568f8b8a15c68a9ece5fe08c66485b.r2.dev/photos/progress/card_progress_0066.jpg`

‚úÖ **–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏**

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:**
- –¢–æ–ª—å–∫–æ –ø–∞–ø–∫–∞ `/photos/progress/` —Å—Ç–∞–ª–∞ –ø—É–±–ª–∏—á–Ω–æ–π
- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª—é–±–æ–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
```bash
curl -I https://pub-92568f8b8a15c68a9ece5fe08c66485b.r2.dev/photos/progress/card_progress_0066.jpg
```

**–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è:** `HTTP/1.1 200 OK` (–Ω–µ 401 Unauthorized)

---

## –§–∞–π–ª—ã –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

- `apply_bucket_policy.py` - —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏  
- `bucket_policy.json` - —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ bucket policy
- `fix_motivational_card_urls.py` - –∫–æ–º–∞–Ω–¥–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è URLs (—É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚úÖ)

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤ Render:
   - `R2_ACCESS_KEY_ID` 
   - `R2_SECRET_ACCESS_KEY`

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å bucket name** –≤ —Å–∫—Ä–∏–ø—Ç–µ: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `ai-fitness-media`

3. **–û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é** –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è